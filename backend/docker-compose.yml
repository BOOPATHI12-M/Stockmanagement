# Docker Compose file for local development and testing
# This makes it easy to run the application with all environment variables

version: '3.8'

services:
  stock-management-backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: sudharshini-stock-backend
    ports:
      - "8080:8080"
    environment:
      # Server Configuration
      - PORT=8080
      - SPRING_PROFILES_ACTIVE=production
      
      # Database Configuration
      - DB_PATH=/tmp/stock_management.db
      
      # JWT Configuration
      - JWT_SECRET=your-secret-key-change-in-production
      - JWT_EXPIRATION=86400000
      
      # Email Configuration
      - MAIL_HOST=smtp.gmail.com
      - MAIL_PORT=587
      - MAIL_USERNAME=your-email@gmail.com
      - MAIL_PASSWORD=your-app-password
      - ADMIN_EMAIL=admin@example.com
      
      # Google OAuth
      - GOOGLE_CLIENT_ID=your-google-client-id
      - GOOGLE_CLIENT_SECRET=your-google-client-secret
      
      # CORS
      - CORS_ORIGINS=http://localhost:3000,http://localhost:5173
      
      # File Uploads
      - UPLOAD_DIR=/tmp/uploads/products
      
      # Logging
      - LOG_FILE=/tmp/application.log
      
      # Java Options
      - JAVA_OPTS=-Xmx512m -Xms256m
    volumes:
      # Persist database (optional - for local development)
      - ./data:/tmp
      # Persist uploads (optional - for local development)
      - ./uploads:/tmp/uploads
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/api/reports/summary"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

